{
  "$schema": "../schema/analyze-rule.schema.json",
  "ruleId": "ANALYZE-ESP-003",
  "title": "Enrollment Duration Exceeded 60 Minutes",
  "description": "Detects when the total Autopilot enrollment takes longer than 60 minutes.",
  "severity": "high",
  "category": "esp",
  "enabled": true,
  "baseConfidence": 50,
  "conditions": [
    {
      "signal": "long_enrollment",
      "source": "phase_duration",
      "eventType": "esp_phase_changed",
      "dataField": "espPhase",
      "operator": "equals",
      "value": "DeviceSetup",
      "required": true
    }
  ],
  "confidenceFactors": [
    { "signal": "long_esp", "condition": "phase_duration > 3600", "weight": 40 }
  ],
  "confidenceThreshold": 70,
  "explanation": "The Autopilot enrollment exceeded 60 minutes. This is unusually long and may indicate stuck apps, slow network, or policy conflicts. The default ESP timeout is 60 minutes, after which the enrollment may be marked as failed.",
  "remediation": [
    {
      "title": "Investigate long enrollment",
      "steps": [
        "Check the app installation timeline - identify which app took the longest",
        "Review download speeds in the performance data",
        "Consider reducing the number of ESP-blocking apps",
        "Check if the ESP timeout policy is configured (default: 60 min)"
      ]
    }
  ],
  "tags": ["esp", "timeout", "duration"]
}
