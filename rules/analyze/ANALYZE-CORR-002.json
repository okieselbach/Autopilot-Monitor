{
  "$schema": "../schema/analyze-rule.schema.json",
  "ruleId": "ANALYZE-CORR-002",
  "title": "Disk Space Exhaustion Caused Installation Failure",
  "description": "Correlates declining disk free space with app installation failure, confirming insufficient storage as root cause.",
  "severity": "critical",
  "category": "apps",
  "enabled": true,
  "trigger": "correlation",
  "baseConfidence": 65,
  "conditions": [
    {
      "signal": "low_disk",
      "source": "event_type",
      "eventType": "performance_snapshot",
      "dataField": "disk_free_gb",
      "operator": "lt",
      "value": "5",
      "required": true
    },
    {
      "signal": "app_failed",
      "source": "event_type",
      "eventType": "app_install_failed",
      "operator": "exists",
      "value": "",
      "required": true
    }
  ],
  "confidenceFactors": [
    { "signal": "multiple_failures", "condition": "count >= 2", "weight": 15 },
    { "signal": "enrollment_failed", "condition": "exists", "weight": 10 }
  ],
  "confidenceThreshold": 50,
  "explanation": "**Root cause confirmed:** Performance monitoring shows disk free space dropped below 5 GB during enrollment, and apps failed to install. The device likely ran out of storage during app installation.\n\nThis is common when deploying many large Win32 apps to devices with small drives (64 GB or 128 GB).",
  "remediation": [
    {
      "title": "Reduce disk consumption during enrollment",
      "steps": [
        "Review total size of all apps deployed during ESP",
        "Move non-critical apps to post-ESP deployment",
        "Use MSIX or Store apps instead of Win32 where possible (smaller footprint)",
        "Clean up IME cache: C:\\Windows\\IMECache"
      ]
    },
    {
      "title": "Use devices with larger drives",
      "steps": [
        "Minimum 128 GB recommended for standard deployments",
        "256 GB recommended when deploying large app suites (Office, Visual Studio, etc.)"
      ]
    }
  ],
  "tags": ["correlation", "apps", "disk-space", "performance", "root-cause"]
}
